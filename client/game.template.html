<!doctype html>
<html lang="en">
    <head>
        [[template "header"]]
        <title>Game: [[.Code]] - Three Names in a Hat</title>
    </head>
    <body>
        <div class="paper container text-center margin-top">
            <div id="game" data-code="[[.Code]]">
                <div v-if="error" v-cloak>
                    <div class="alert alert-danger">{{error}}</div>
                    <a class="paper-btn btn-large" href="/game/[[.Code]]">
                        Try Again
                    </a>
                </div>
                <form v-else-if="!game" @submit.prevent="join">
                    <div class="form-group large">
                        <label for="playerName">Enter your name:</label>
                        <input class="input-block"
                            v-model="playerName"
                            v-focus
                            type="text"
                            id="playerName">
                        <p v-if="playerNameErr" v-cloak class="text-danger">{{playerNameErr}}</p>
                    </div>
                    <button type="submit" class="btn-large"
                        :disabled="loading"
                        :class="{'loading':loading}">Join</button>
                </form>
                <div v-else-if="settings" v-cloak>
                    <h2>Number of names from each player</h2>
                    <div class="row flex-center">
                        <div class="col-2 col"><h1>{{game.namesPerPlayer}}</h1></div>
                        <div class="col-2 col">
                            <button @click="setNamesPerPlayer(1)"
                                class="btn-large margin-bottom">&#9650;</button>
                            <button @click="setNamesPerPlayer(-1)"
                                class="btn-large">&#9660;</button>
                        </div>
                    </div>

                    <button class="btn-large margin-top"
                        @click="settings=false">Return</button>
                </div>
                <div v-else v-cloak>
                    <div v-if="game.stage=='pregame'">
                        <button v-if="leader"
                            @click="settings=true"
                            class="btn-settings">
                            [[template "gear"]]
                        </button>
                        <h2>Enter the Code below to join</h2>
                        <h1 id="gameCode"><strong>{{code}}</strong></h1>
                        <div v-if="leader">
                            <button v-if="canStart"
                                @click="startGame"
                                :disabled="loading"
                                :class="{'loading':loading}"
                                class="btn-large btn-success">
                                Start the Game if everyone is ready
                            </button>
                            <div v-else class="alert alert-primary">
                                Waiting until each team has at least 2 players
                            </div>
                        </div>
                        <div v-else class="alert alert-primary">
                            Waiting until each team has at least 2 players
                        </div>
                        <div>
                            <button class="paper-btn margin btn-secondary"
                                :disabled="loading"
                                @click="send('switchteams')">
                                Switch Teams
                            </button>
                            <div class="row flex-center">
                                <div class="col-5 col border border-6
                                    border-primary">
                                    <h3>Team 1</h3>
                                    <p v-for="player of game.team1.players"
                                        key="player.name"
                                        class="player-name"
                                        :class="{'self': player.name === playerName}">
                                        <span v-if="player.name === game.leader.name">&#9733;</span>
                                        {{player.name}}
                                    </p>
                                </div>
                                <div class="col-1"></div>
                                <div class="col-5 col border border-3
                                    border-primary">
                                    <h3>Team 2</h3>
                                    <p v-for="player of game.team2.players"
                                        key="player.name"
                                        :class="{'self': player.name === playerName}"
                                        class="player-name">
                                        <span v-if="player.name === game.leader.name">&#9733;</span>
                                        {{player.name}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="game.stage=='setup'">
                        <h3>Please Enter {{game.namesPerPlayer}} names</h3>
                        <form @submit.prevent="submitName">
                            <div class="form-group large">
                                <label for="addName">Enter a name</label>
                                <p>Pick a name everyone in the game would recognize</p>
                                <input class="input-block"
                                    v-model="addName"
                                    v-focus
                                    type="text"
                                    id="addName">
                                <button type="submit" class="btn-large">Add</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>

        [[template "footer"]]

        <script src="/js/vue.min.js"></script>
        <script src="/js/game.js"></script>
    </body>
</html>