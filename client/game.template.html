<!doctype html>
<html lang="en">
    <head>
        [[template "header"]]
        <title>Game: [[.Code]] - Three Names in a Hat</title>
    </head>
    <body>
        <div class="paper container text-center margin-top">
            <div id="game" data-code="[[.Code]]">
                <span v-if="game" v-cloak class="player-name">{{playerName}}</span>
                <div v-if="error" v-cloak>
                    <div class="alert alert-danger">{{error}}</div>
                    <a class="paper-btn btn-large" href="/game/[[.Code]]">
                        Try Again
                    </a>
                </div>
                <form v-else-if="!game" @submit.prevent="join">
                    <div class="form-group large">
                        <label for="playerName">Enter your name:</label>
                        <input class="input-block"
                            v-model="playerName"
                            v-focus
                            type="text"
                            id="playerName">
                        <p v-if="playerNameErr" v-cloak class="text-danger">{{playerNameErr}}</p>
                    </div>
                    <button type="submit" class="btn-large"
                        :disabled="loading"
                        :class="{'loading':loading}">Join</button>
                </form>
                <div v-else-if="settings" v-cloak>
                    <h2>Number of names from each player</h2>
                    <div class="row flex-center">
                        <div class="col-2 col"><h1>{{game.namesPerPlayer}}</h1></div>
                        <div class="col-2 col">
                            <button @click="setNamesPerPlayer(1)"
                                class="btn-large margin-bottom">&#9650;</button>
                            <button @click="setNamesPerPlayer(-1)"
                                class="btn-large">&#9660;</button>
                        </div>
                    </div>

                    <button class="btn-large margin-top"
                        @click="settings=false">Return</button>
                </div>
                <div v-else v-cloak>
                    <div v-if="game.stage=='pregame'">
                        <button v-if="leader"
                            @click="settings=true"
                            class="btn-settings">
                            [[template "gear"]]
                        </button>
                        <h2>New players can enter the code below to join</h2>
                        <h1 id="gameCode"><strong>{{code}}</strong></h1>
                        <div v-if="canStart">
                            <button v-if="leader"
                                @click="startGame"
                                :disabled="loading"
                                :class="{'loading':loading}"
                                class="btn-large btn-success">
                                Start the Game if everyone is ready
                            </button>
                            <div v-else class="alert alert-primary">
                                Waiting for the game to start
                            </div>
                        </div>
                        <div v-else class="alert alert-primary">
                            Waiting until each team has at least 2 players
                        </div>
                        <div>
                            <button class="paper-btn margin btn-secondary"
                                :disabled="loading"
                                @click="send('switchteams')">
                                Switch Teams
                            </button>
                            <div class="row flex-center">
                                <div class="col-5 col border border-6
                                    border-primary">
                                    <h2 class="margin-none">Team 1</h2>
                                    <p v-for="player of game.team1.players"
                                        key="player.name"
                                        class="list-name"
                                        :class="{'highlight': player.name === playerName}">
                                        {{player.name}}
                                        <span v-if="player.name === game.leader.name" class="badge">leader</span>
                                    </p>
                                </div>
                                <div class="col-1"></div>
                                <div class="col-5 col border border-3
                                    border-primary">
                                    <h2 class="margin-none">Team 2</h2>
                                    <p v-for="player of game.team2.players"
                                        key="player.name"
                                        :class="{'highlight': player.name === playerName}"
                                        class="list-name">
                                        {{player.name}}
                                        <span v-if="player.name === game.leader.name" class="badge">leader</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div> <!-- pregame -->
                    <div v-if="game.stage=='setup'">
                        <div v-if="game.timer.left> 0" v-cloak class="progress margin-top margin-bottom">
                            <div class="bar" :class="timerStyle" :style="{width: timerPercent + '%'}"></div>
                        </div>
                        <div v-if="namesLeft >= 1">
                            <h3 v-if="namesLeft === game.namesPerPlayer">Please enter {{namesLeft}} names</h3>
                            <h3 v-else-if="namesLeft === 1">Please enter 1 more name</h3>
                            <h3 v-else>Please enter {{namesLeft}} more names</h3>
                            <form @submit.prevent="submitName">
                                <div class="form-group large">
                                    <p>Pick a name everyone in the game would recognize</p>
                                    <!-- TODO: add more hints as timer ticks -->
                                    <input class="input-block"
                                        v-model="addName"
                                        v-focus
                                        type="text"
                                        id="addName">
                                    <button type="submit" class="btn-large margin-top">Add</button>
                                </div>
                            </form>
                        </div>
                        <div v-else class="alert alert-primary">
                            Waiting for the other players to finish adding names
                        </div>
                        <div v-if="namesLeft !== game.namesPerPlayer" class="border border-3 border-primary text-left
                            padding-large margin-large">
                            <p v-for="name of player.names" class="list-name" key="name">
                                <button class="paper-btn margin-right" @click="removeName(name)">X</button>
                                {{name}}
                            </p>
                        </div>

                    </div> <!-- setup -->
                    <div v-if="game.stage=='playing' || game.stage=='stealing'">
                        <h1 class="margin-none">Round {{game.round}}</h1>
                        <div v-if="game.timer.left> 0" v-cloak class="progress margin-top margin-bottom">
                            <div class="bar" :class="timerStyle" :style="{width: timerPercent + '%'}"></div>
                        </div>
                        <div v-if="game.stage=='playing'">
                            <div v-if="game.clueGiver.name === playerName">
                                <h1 class="text-secondary"><strong>{{currentName}}</strong></h1>
                                <button v-if="currentName && game.timer.left" class="btn-large"
                                    @click="send('nextname')">Next Name</button>
                                <button v-else class="btn-large btn-success" @click="send('startturn')">Start</button>
                            </div>
                            <div v-else>
                                <h3>It is {{game.clueGiver.name}}'s turn</h3>
                                <p v-if="isGuessing && game.timer.left> 0">Try to guess the name!</p>
                                <p v-else-if="isGuessing">When the timer starts, try to guess the name.</p>
                                <p v-else>Wait for your team's turn</p>
                            </div>
                        </div>
                        <div v-if="game.stage=='stealing'">
                            <h3 class="margin-none">Team {{waitingTeam}} gets a chance to steal!</h3>
                            <div v-if="game.clueGiver.name === playerName">
                                <h1 class="text-secondary"><strong>{{currentName}}</strong></h1>
                            </div>
                            <div v-if="stealing">
                                <button class="btn-large btn-success" @click="sendStealConfirm">Final Answer</button>
                            </div>
                            <div v-else-if="stealCheck">
                                <h3 class="margin-none">Did <strong>Team {{waitingTeam}}</strong> get it correct?</h3>
                                <button class="btn-large btn-success" @click="stealCheckConfirm(true)">Yes</button>
                                <button class="btn-large btn-danger" @click="stealCheckConfirm(false)">No</button>
                            </div>

                        </div>
                        <hr class="padding-top-large">
                        <div v-cloak class="instructions" v-if="game.round===1">
                            <p>Say anything as long as it's not part of the person's name or a direct reference to
                                their name.</p>
                            <p class="text-danger">
                                No "Rhymes with"
                                <br>
                                No "Starts with"
                                <br>
                                Saying any part of the name
                            </p>
                        </div>
                        <div v-cloak class="instructions" v-if="game.round===2">
                            <p>Act out clues</p>
                            <p class="text-danger">
                                No speaking
                                <br>
                                No making noises
                            </p>
                        </div>
                        <div v-cloak class="instructions" v-if="game.round===3">
                            <p>Say <strong>ONLY ONE</strong> word</p>
                            <p class="text-danger">
                                No acting out additional clues
                                <br>
                                No speaking any other words
                                <br>
                                No making noises
                            </p>
                        </div>

                        <!-- team scoreboard -->
                        <div class="row flex-center margin-top">
                            <div class="col-5 col border border-6 border-primary">
                                <h2 class="margin-none">Team 1</h2>
                                <p class="list-name">{{game.stats.team1Score}}</p>
                            </div>
                            <div class="col-1"></div>
                            <div class="col-5 col border border-3 border-primary">
                                <h2 class="margin-none">Team 2</h2>
                                <p class="list-name">{{game.stats.team2Score}}</p>
                            </div>
                        </div>

                    </div> <!-- playing -->
                    <div v-if="game.stage=='end'">
                        <h2 class="margin-none">Game Over</h2>
                        <h1 class="text-secondary"><strong>Team {{game.stats.winner}} won!</strong></h1>
                    </div>
                </div>
            </div><!-- game -->
        </div>
        [[template "footer"]]

        <script src="/js/vue.min.js"></script>
        <script src="/js/game.js"></script>
    </body>
</html>